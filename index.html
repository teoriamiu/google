<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sans Flex: Master Dashboard 2.0</title>
    
    <script src="./js/sortable/sortable.min.js"></script>
    <script src="./js/chart/chart.min.js"></script>
    
    <style>
        @font-face {
            font-family: 'GSansFlex';
            src: url('./fonts/GoogleSansFlex.ttf') format('truetype');
            font-weight: 100 1000;
        }

        :root {
            --wght: 400; --wdth: 100; --opsz: 14; --GRAD: 0; --slnt: 0; --ROND: 0;
            --bg: #0d1117; --panel: #161b22; --accent: #58a6ff;
        }

        body {
            font-family: 'GSansFlex', sans-serif;
            background: var(--bg); color: #c9d1d9;
            margin: 0; padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: row; /* Desktop por defecto */
        }

        /* --- SIDEBAR (Izquierda en Desktop, Abajo en Móvil) --- */
        .sidebar {
            width: 320px;
            background: var(--panel);
            padding: 20px;
            border-right: 1px solid #30363d;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 10;
        }

        h3 { margin-top: 0; font-size: 1.2rem; color: var(--accent); }

        .control-card {
            background: #21262d; 
            padding: 15px; 
            border-radius: 12px;
            margin-bottom: 12px; 
            cursor: grab; 
            border: 1px solid #30363d;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .label-row { display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 10px; opacity: 0.8; }
        .val { color: var(--accent); font-weight: bold; }
        input[type="range"] { width: 100%; accent-color: var(--accent); cursor: pointer; }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 40px;
            gap: 20px;
            overflow: hidden;
            justify-content: center;
        }

        .preview-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.02);
            border-radius: 20px;
            border: 1px dashed #30363d;
        }

        #preview-text {
            width: 100%;
            font-size: clamp(2rem, 10vw, 8rem); /* Tamaño fluido */
            text-align: center;
            outline: none;
            padding: 20px;
            font-variation-settings: 'wght' var(--wght), 'wdth' var(--wdth), 'opsz' var(--opsz), 'GRAD' var(--GRAD), 'slnt' var(--slnt), 'ROND' var(--ROND);
            font-optical-sizing: none;
            word-wrap: break-word;
        }

        .charts-container {
            height: 250px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 850px) {
            body { flex-direction: column; overflow-y: auto; height: auto; }
            .sidebar { width: auto; border-right: none; border-top: 1px solid #30363d; order: 2; height: auto; }
            .main-content { order: 1; height: 80vh; padding: 20px; }
            .preview-container { min-height: 300px; }
            .charts-container { height: 200px; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h3>Flex Controls</h3>
        <div id="controls-list">
            <div class="control-card" data-id="wght">
                <div class="label-row"><span>WEIGHT</span> <span class="val" id="v-wght">400</span></div>
                <input type="range" id="wght" min="100" max="1000" value="400">
            </div>
            <div class="control-card" data-id="wdth">
                <div class="label-row"><span>WIDTH</span> <span class="val" id="v-wdth">100</span></div>
                <input type="range" id="wdth" min="25" max="151" value="100">
            </div>
            <div class="control-card" data-id="ROND">
                <div class="label-row"><span>ROUND</span> <span class="val" id="v-ROND">0</span></div>
                <input type="range" id="ROND" min="0" max="100" value="0">
            </div>
            <div class="control-card" data-id="GRAD">
                <div class="label-row"><span>GRADE</span> <span class="val" id="v-GRAD">0</span></div>
                <input type="range" id="GRAD" min="-200" max="150" value="0">
            </div>
            <div class="control-card" data-id="opsz">
                <div class="label-row"><span>OPTICAL</span> <span class="val" id="v-opsz">14</span></div>
                <input type="range" id="opsz" min="8" max="144" value="14">
            </div>
            <div class="control-card" data-id="slnt">
                <div class="label-row"><span>SLANT</span> <span class="val" id="v-slnt">0</span></div>
                <input type="range" id="slnt" min="-10" max="0" value="0">
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div class="preview-container">
            <div id="preview-text" contenteditable="true">Google Sans Flex</div>
        </div>
        <div class="charts-container">
            <canvas id="fontChart"></canvas>
        </div>
    </main>

    <script>
        window.onload = () => {
            // Sortable
            const el = document.getElementById('controls-list');
            if (typeof Sortable !== 'undefined') {
                Sortable.create(el, { animation: 150, delay: 200});
            }

            // Chart Doughnut
            let myChart;
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById('fontChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Weight', 'Width', 'Round', 'Grade', 'Optical', 'Slant'],
                        datasets: [{
                            data: [400, 100, 1, 1, 14, 1],
                            backgroundColor: ['#58a6ff', '#3fb950', '#d29922', '#f85149', '#8b949e', '#db61a2'],
                            borderWidth: 0,
                            cutout: '20%'
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: { legend: { display: true, position: 'bottom', labels: { color: '#8b949e', boxWidth: 10 } } }
                    }
                });
            }

            // Update
            document.querySelectorAll('input').forEach(input => {
                input.oninput = (e) => {
                    const val = e.target.value;
                    const id = e.target.id;
                    document.documentElement.style.setProperty(`--${id}`, val);
                    document.getElementById(`v-${id}`).innerText = val;

                    if (myChart) {
                        const idx = { 'wght': 0, 'wdth': 1, 'ROND': 2, 'GRAD': 3, 'opsz': 4, 'slnt': 5 };
                        // Normalización básica para el gráfico
                        let chartVal = Math.abs(parseFloat(val));
                        if(id === 'wght') chartVal = val / 2;
                        if(id === 'GRAD') chartVal = (chartVal + 200) / 4;
                        
                        myChart.data.datasets[0].data[idx[id]] = chartVal || 1; 
                        myChart.update('none');
                    }
                };
            });
        };
    </script>
</body>
</html>