<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sans Flex: Master Dashboard</title>
    
    <script src="./js/sortable.min.js"></script>
    <script src="./js/chart.min.js"></script>
    
    <style>
        @font-face {
            font-family: 'GSansFlex';
            /* RUTA CORREGIDA: Entra a fonts/ y busca el archivo */
            src: url('./fonts/GoogleSansFlex.ttf') format('truetype');
            font-weight: 100 1000;
        }

        :root {
            --wght: 400; --wdth: 100; --opsz: 14; --GRAD: 0; --slnt: 0; --ROND: 0;
            --bg: #0d1117; --panel: #161b22; --accent: #58a6ff;
        }

        body {
            font-family: 'GSansFlex', sans-serif;
            background: var(--bg); color: #c9d1d9;
            margin: 0; display: grid; grid-template-columns: 320px 1fr;
            height: 100vh; overflow: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            background: var(--panel); padding: 20px;
            border-right: 1px solid #30363d; display: flex; flex-direction: column;
        }

        .control-card {
            background: #21262d; padding: 12px; border-radius: 8px;
            margin-bottom: 10px; cursor: grab; border: 1px solid #30363d;
        }

        .label-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 5px; }
        .val { color: var(--accent); font-weight: bold; }
        input[type="range"] { width: 100%; accent-color: var(--accent); cursor: pointer; }

        /* --- PREVIEW --- */
        .main-content {
            display: grid; grid-template-rows: 1fr 250px; padding: 20px; gap: 10px;
        }

        #preview-text {
            font-size: 7vw; text-align: center; align-self: center; outline: none;
            font-variation-settings: 'wght' var(--wght), 'wdth' var(--wdth), 'opsz' var(--opsz), 'GRAD' var(--GRAD), 'slnt' var(--slnt), 'ROND' var(--ROND);
            font-optical-sizing: none;
        }

        .charts-container {
            background: rgba(255,255,255,0.02); border-radius: 12px;
            padding: 15px; display: flex; justify-content: center;
        }

        canvas { max-width: 100%; height: 220px !important; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h3>Lab Console</h3>
        <div id="controls-list">
            <div class="control-card" data-id="wght">
                <div class="label-row"><span>WEIGHT</span> <span class="val" id="v-wght">400</span></div>
                <input type="range" id="wght" min="100" max="1000" value="400">
            </div>
            <div class="control-card" data-id="wdth">
                <div class="label-row"><span>WIDTH</span> <span class="val" id="v-wdth">100</span></div>
                <input type="range" id="wdth" min="25" max="151" value="100">
            </div>
            <div class="control-card" data-id="ROND">
                <div class="label-row"><span>ROUND</span> <span class="val" id="v-ROND">0</span></div>
                <input type="range" id="ROND" min="0" max="100" value="0">
            </div>
            <div class="control-card" data-id="GRAD">
                <div class="label-row"><span>GRADE</span> <span class="val" id="v-GRAD">0</span></div>
                <input type="range" id="GRAD" min="-200" max="150" value="0">
            </div>
            <div class="control-card" data-id="opsz">
                <div class="label-row"><span>OPTICAL</span> <span class="val" id="v-opsz">14</span></div>
                <input type="range" id="opsz" min="8" max="144" value="14">
            </div>
            <div class="control-card" data-id="slnt">
                <div class="label-row"><span>SLANT</span> <span class="val" id="v-slnt">0</span></div>
                <input type="range" id="slnt" min="-10" max="0" value="0">
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div id="preview-text" contenteditable="true">G Sans Flex</div>
        <div class="charts-container">
            <canvas id="fontChart"></canvas>
        </div>
    </main>

    <script>
        // --- DEPURACIÓN: ¿Están las librerías cargadas? ---
        window.onload = () => {
            if (typeof Sortable === 'undefined') console.error("❌ SortableJS no cargó. Revisa js/Sortable.min.js");
            if (typeof Chart === 'undefined') console.error("❌ Chart.js no cargó. Revisa js/chart.min.js");
            
            document.fonts.ready.then(() => {
                if (!document.fonts.check('1em "GSansFlex"')) console.warn("⚠️ Fuente no detectada en fonts/GoogleSansFlex.ttf");
            });

            // Inicializar Sortable
            const el = document.getElementById('controls-list');
            if (typeof Sortable !== 'undefined') Sortable.create(el, { animation: 150 });

            // Inicializar Chart
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById('fontChart').getContext('2d');
                window.myChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Weight', 'Width', 'Round', 'Grade', 'Optical', 'Slant'],
                        datasets: [{
                            data: [400, 100, 0, 0, 14, 0],
                            backgroundColor: 'rgba(88, 166, 255, 0.2)',
                            borderColor: '#58a6ff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        scales: { r: { beginAtZero: true, grid: { color: '#333' }, ticks: { display: false } } },
                        plugins: { legend: { display: false } },
                        maintainAspectRatio: false
                    }
                });
            }
        };

        // --- LÓGICA DE ACTUALIZACIÓN ---
        document.querySelectorAll('input').forEach(input => {
            input.oninput = (e) => {
                const val = e.target.value;
                const id = e.target.id;
                document.documentElement.style.setProperty(`--${id}`, val);
                document.getElementById(`v-${id}`).innerText = val;

                if (window.myChart) {
                    // Actualizamos el radar
                    const chartData = [
                        document.getElementById('wght').value / 10,
                        document.getElementById('wdth').value,
                        document.getElementById('ROND').value,
                        (parseInt(document.getElementById('GRAD').value) + 200) / 3.5,
                        document.getElementById('opsz').value,
                        Math.abs(document.getElementById('slnt').value) * 10
                    ];
                    window.myChart.data.datasets[0].data = chartData;
                    window.myChart.update('none'); // Update sin animaciones para mayor fluidez
                }
            };
        });
    </script>
</body>
</html>